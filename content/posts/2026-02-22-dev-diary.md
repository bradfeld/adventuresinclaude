---
title: "Treasure Troves and Portable Companies"
date: 2026-02-23T11:05:00-07:00
description: "Building a suggestions tracker for cancer care, making CompanyOS work for more than one company, and thirty-five tickets on a Sunday."
draft: true
tags: ["dev-diary", "claude-code", "curecancermagic", "companyos", "supabase"]
---

A friend of mine is dealing with cancer. When I started building [CureCancerMagic](https://curecancermagic.com) - a care coordination app for exactly this situation - I noticed something about how information flows during treatment. Doctors send referrals. Friends text you articles. Someone at a dinner party mentions a clinical trial. Your cousin emails a link to a specialist in another city. All of it is valuable. Almost all of it gets lost.

Sunday I built a feature called the Treasure Trove to fix that. The rest of the day I spent making [CompanyOS](https://github.com/bradfeld/companyos) - my markdown-based company operations system - work for more than one company. Thirty-five Linear tickets closed by end of day.

---

## Things We Learned Today

The product insight behind the Treasure Trove came from watching how information actually moves through a cancer care network. I was building the email processing pipeline for CureCancerMagic - the system where care team members forward emails to a case-specific address and the AI extracts contacts, categorizes communications, and links everything to the right people.

While debugging that pipeline, I realized the emails contained something I hadn't designed for. Buried in messages from doctors, nurses, friends, and family were *suggestions* - a doctor to call, a treatment to research, a second opinion to get, a clinical trial to look into. These suggestions are the most actionable information in the entire email stream, and the system was treating them the same as everything else. They'd land in the communications inbox and scroll off the page within a day.

The Treasure Trove is a separate section of the dashboard that pulls these suggestions out of the email stream and presents them as trackable items. Each suggestion has a source contact, a category, and a status. The AI does the extraction - it reads incoming emails and identifies anything that looks like a recommendation, referral, or lead - and the care team can accept, dismiss, or act on each one. The key design choice: suggestions surface *automatically* from emails that are already flowing through the system. Nobody has to manually enter "Dr. Smith recommended we call Dr. Jones." The email from Dr. Smith already says that, and the system picks it up.

This is the kind of feature that only becomes obvious after you've watched real data flow through the system. I wouldn't have designed it from a blank sheet of paper.

---

## Things We Did Today

CureCancerMagic is now a real application with a full dashboard. Here's what it can do as of Sunday night:

The dashboard is organized around a *case* - one patient, one cancer diagnosis. Everything in the app is scoped to a case, not a user, because multiple care team members need to see the same data. A spouse, an adult child, a patient advocate, and the patient themselves might all be on the same case.

Inside a case, there are contacts - every person involved in care, from oncologists to insurance reps to the neighbor who drove someone to chemo. The contacts page has detail views with all their information, and the system automatically extracts contact info from incoming emails and links emails to the right people.

There's an email inbox with a quarantine system. Each case gets a unique email address. Forwarded emails get AI-processed - summarized, categorized, contacts extracted. Emails from unknown senders go to quarantine until a care team member approves them, at which point they flow into the inbox and get the full AI treatment. A rejected folder holds the ones that don't belong.

The communications page tracks all interactions. Tasks lets the care team manage action items. The timeline provides a chronological view of everything that's happened - appointments, emails, status changes. A documents section stores files. Reports include an appointment summary view. Settings is where the case email address now lives (moved it off the dashboard on Sunday). And as of yesterday, the Treasure Trove.

Three of Sunday's CureCancerMagic fixes were in the email pipeline. Emails weren't appearing after quarantine approval because the approval path bypassed AI processing - the email got marked as approved but skipped the step that generates summaries and extracts contacts. Emails from contacts already in the system were incorrectly being routed to quarantine instead of going straight through. And email bodies that failed to fetch from the email provider now get tracked with an unrecoverable state instead of silently failing and leaving blank entries.

---

The other half of Sunday was CompanyOS. I wrote about [the system itself](https://adventuresinclaude.ai/posts/2026-02-21-running-a-company-on-markdown-files/) yesterday. Sunday's work was about making it portable.

CompanyOS was built for IntensityMagic - my company. Every skill had IntensityMagic's Help Scout inbox ID hardcoded, IntensityMagic's Linear workspace assumed, IntensityMagic's brand voice baked in. [Seth Levine](https://sethlevine.com) at Foundry is the first external user, and he needs it to work for a different company with different services.

The architecture decision I landed on: each company gets its own CompanyOS clone in a separate directory. `~/Code/companyos` for IntensityMagic, `~/Code/companyos-foundry` for Foundry. Each clone points to a private config repo that holds that company's context - Help Scout credentials, Linear workspace, brand voice, employee list. The core skills are shared across all clones via git. Company-specific configuration is isolated per directory.

The reason this works is that Claude Code sessions are inherently directory-scoped. When I open a terminal in `~/Code/companyos-foundry`, Claude loads Foundry's MCP servers, reads Foundry's company context, and has no awareness of IntensityMagic's data. The isolation comes from the directory boundary, not from any access control system I had to build. This is the same pattern I use for the magic platform's eight worktrees - directory equals context.

Sunday's implementation covered a lot of ground: parameterized 8 portable skills to read from a company context file instead of hardcoded values, added a `--config` flag to `setup.sh` for pointing at external config repos, built a `co-switch` command for quick context flips, extracted IntensityMagic's config into its own section, tightened RLS policies for open-source readiness, added template version checking, and updated the skill creation command to handle company-specific skills. Fifteen CompanyOS commits.

---

The platform also got three production releases on Sunday. Rankings sync for AuthorMagic increased from every three hours to hourly. Twelve remaining cron jobs got integrated with the notification registry. A new Sentry-to-Linear routing system automatically creates tickets from production errors. And a platform-level env var utility with built-in `.trim()` and validation shipped - one of those "should have existed from the start" utilities.

---

## Fun Things to Try

The Treasure Trove currently extracts suggestions from emails. The next obvious step is extracting them from meeting transcripts. Granola - the meeting recorder I use - produces full transcripts that the `co-meetings` skill already knows how to pull. Running the same suggestion extraction logic against meeting transcripts would catch the verbal recommendations that never make it into email. "You should really talk to Dr. Jones" said in a meeting is just as valuable as the same sentence in an email.

---

CompanyOS's per-directory isolation model works because I set up each clone manually. The onboarding script handles it, but what if it didn't need a separate clone at all? Git worktrees share the same `.git` directory, which means `.gitignore`'d files are per-worktree but tracked files are shared. If company configs lived entirely in `.gitignore`'d paths, worktrees could provide isolation within a single repo. I decided against this on Sunday - separate clones are cleaner - but it's worth revisiting if the "clone per company" approach gets unwieldy at ten or twenty companies.

---

*Generated from daily notes. Review and edit before publishing.*
