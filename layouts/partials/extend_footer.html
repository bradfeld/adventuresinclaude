<script>
(function() {
  fetch('/api/subscribers')
    .then(function(r) { return r.json(); })
    .then(function(d) {
      if (d.count > 0) {
        var links = document.querySelectorAll('.social-icons a');
        links.forEach(function(a) {
          if (a.href && a.href.indexOf('kit.com') !== -1) {
            var span = document.createElement('span');
            span.style.cssText = 'font-size:0.85em;opacity:0.7;margin-left:4px;';
            span.textContent = '(' + d.count + ')';
            a.parentNode.insertBefore(span, a.nextSibling);
          }
        });
      }
    })
    .catch(function() {});
})();
</script>
{{ if .IsPage }}
<div class="reading-progress" id="reading-progress"></div>
<script>
(function() {
  var bar = document.getElementById('reading-progress');
  if (!bar) return;
  window.addEventListener('scroll', function() {
    var h = document.documentElement;
    var scrollTop = h.scrollTop || document.body.scrollTop;
    var scrollHeight = h.scrollHeight - h.clientHeight;
    if (scrollHeight > 0) {
      bar.style.width = (scrollTop / scrollHeight * 100) + '%';
    }
  });
})();
</script>
{{ end }}
