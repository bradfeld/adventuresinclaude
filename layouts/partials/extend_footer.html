<script>
(function() {
  var el = document.querySelector('.post-content p, .entry-content p, .page-content p');
  if (!el) return;
  var info = document.querySelector('.first-entry .entry-content');
  if (!info) return;
  fetch('/api/subscribers')
    .then(function(r) { return r.json(); })
    .then(function(d) {
      if (d.count > 0) {
        var p = document.createElement('p');
        p.style.cssText = 'margin-top:0.5em;font-size:0.9em;opacity:0.7;';
        p.textContent = 'Join ' + d.count + (d.count === 1 ? ' subscriber' : ' subscribers') + ' getting new posts by email.';
        info.appendChild(p);
      }
    })
    .catch(function() {});
})();
</script>
{{ if .IsPage }}
<div class="reading-progress" id="reading-progress"></div>
<script>
(function() {
  var bar = document.getElementById('reading-progress');
  if (!bar) return;
  window.addEventListener('scroll', function() {
    var h = document.documentElement;
    var scrollTop = h.scrollTop || document.body.scrollTop;
    var scrollHeight = h.scrollHeight - h.clientHeight;
    if (scrollHeight > 0) {
      bar.style.width = (scrollTop / scrollHeight * 100) + '%';
    }
  });
})();
</script>
{{ end }}
